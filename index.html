<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Recriando o Modulo Inventory - DW AdventureWorks</title>

    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-sql.min.js"></script>
    
    <style>
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Merriweather', Georgia, serif;
            line-height: 1.6;
            background-color: #ffffff;
            color: #222222;
            max-width: 900px;
            margin: 40px auto;
            padding: 0 20px;
        }

        h1, h2, h3, h4 {
            font-family: 'Work Sans', Helvetica, Arial, sans-serif;
            color: #111111;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 2.2em;
            margin-bottom: 20px;
        }

        h2 {
            font-size: 1.8em;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        h3 {
            font-size: 1.4em;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        p {
            margin-bottom: 15px;
        }

        ul, ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        pre {
            background-color: #f6f8fa;
            padding: 15px;
            border-left: 4px solid #222222;
            overflow-x: auto;
            margin-bottom: 15px;
        }

        code {
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, Courier, monospace;
            background-color: #f6f6f6;
            padding: 2px 4px;
            border-radius: 3px;
        }

        a {
            color: #1a0dab;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        img {
            max-width: 100%;
            display: block;
            margin: 20px 0;
        }

        hr {
            border: 0;
            border-top: 1px solid #ccc;
            margin: 30px 0;
        }

        .section {
            margin-bottom: 40px;
        }

        .emoji {
            margin-right: 5px;
        }
    </style>
</head>
<body>

<h1>Recriando o Modulo Inventory do Data Warehouse AdventureWorks 2022</h1>

<div class="section">
    <h2><span class="emoji">ðŸ“Œ</span>1. Objetivo do projeto</h2>
    <p>Construir um Data Warehouse para o mÃ³dulo Inventory do AdventureWorks 2022, replicando o fluxo OLTP â†’ DW para permitir anÃ¡lises histÃ³ricas e mÃ©tricas de inventÃ¡rio de modo simplificado.</p>
    <p>Este projeto foi desenvolvido com foco em:</p>
    <ul>
        <li>Criar e carregar tabelas de staging (stg_)</li>
        <li>Criar e carregar tabelas de DimensÃ£o e Fato</li>
        <li>Aplicar transformaÃ§Ãµes simples para padronizaÃ§Ã£o</li>
        <li>Utilizar MERGE para cargas</li>
        <li>ImplementaÃ§Ã£o de chaves surrogate (SK)</li>
        <li>PadronizaÃ§Ã£o de datas via DimDate</li>
    </ul>
</div>

<div class="section">
    <h2><span class="emoji">ðŸ“Œ</span>2. Ferramentas Utilizadas</h2>
    <ul>
        <li>SQL Server</li>
        <li>SQL Server Management Studio (SSMS)</li>
        <li>AdventureWorks 2022 OLTP (<a href="https://github.com/Microsoft/sql-server-samples/releases/download/adventureworks/AdventureWorks2022.bak" target="_blank">link do backup</a>)</li>
    </ul>
</div>

<div class="section">
    <h2><span class="emoji">ðŸ“Œ</span>3. Arquitetura do Projeto</h2>
    <p>O DW foi construÃ­do seguindo um modelo dimensional no formato Star Schema, porÃ©m com caracterÃ­sticas de Snowflake tambÃ©m, por conta da hierarquia de produtos.</p>
    <p><strong>Tabelas de DimensÃ£o:</strong></p>
    <ul>
        <li>DimProduct</li>
        <li>DimProductSubcategory</li>
        <li>DimProductCategory</li>
        <li>DimDate</li>
    </ul>
    <p><strong>Tabela de Fato:</strong></p>
    <ul>
        <li>FactProductInventory</li>
    </ul>
    <img src="./docs/Modelo_Dimensional.png" alt="Resultado final do Modelo Dimensional">
</div>

<div class="section">
    <h2><span class="emoji">ðŸ“Œ</span>4. Etapas</h2>

    <h3>4.1 LocalizaÃ§Ã£o e seleÃ§Ã£o dos dados no OLTP para compor o DW</h3>
    <ul>
        <li>A estrutura do Data Warehouse original do AdventureWorks foi analisada usando como referencia: <a href="https://dataedo.com/samples/html/Data_warehouse/" target="_blank">link</a></li>
        <li>As tabelas do OLTP com dados relevantes para a construÃ§Ã£o do mÃ³dulo Inventory foram mapeadas.</li>
        <li>Chaves primÃ¡rias e os relacionamentos do modelo transacional foram identificados.</li>
    </ul>

    <h3>4.2 CriaÃ§Ã£o da tabela DimDate</h3>
    <p>A primeira estrutura criada foi a DimDate, responsÃ¡vel por padronizar todas as datas usadas no DW.</p>
    <pre><code class="language-sql">
        CREATE TABLE dbo.DimDate (
    DateKey INT PRIMARY KEY,
    FullDate DATE NOT NULL,
    DayNumberOfWeek TINYINT,
    DayNumberOfMonth TINYINT,
    MonthNumberOfYear TINYINT,
    CalendarYear SMALLINT
);</code></pre>

    <h3>4.3 CriaÃ§Ã£o das tabelas de Staging (STG)</h3>
    <p>Foram criadas tabelas intermediÃ¡rias (staging) para as DimensÃµes para receber os dados brutos vindos do OLTP.</p>
    <pre><code class="language-sql">
        CREATE TABLE stg.DimProduct (
    ProductAlternateKey NVARCHAR(25) NOT NULL,
    ProductSubcategoryKey INT NULL,
    EnglishProductName NVARCHAR(50) NULL,
    Color NVARCHAR(15) NULL,
    StandardCost MONEY NULL,
    SellStartDate DATETIME NULL,
    SellEndDate DATETIME NULL,
    Status NVARCHAR(20) NULL
);</code></pre>

    <h3>4.4 CriaÃ§Ã£o das tabelas finais do Data Warehouse</h3>
    <pre><code class="language-sql">
        CREATE TABLE dbo.DimProduct (
    ProductKey INT IDENTITY(1,1) PRIMARY KEY,
    ProductAlternateKey NVARCHAR(25) NOT NULL,
    ProductSubcategoryKey INT NULL,
    EnglishProductName NVARCHAR(50) NULL,
    Color NVARCHAR(15) NULL,
    StandardCost MONEY NULL,
    SellStartDate DATETIME NULL,
    SellEndDate DATETIME NULL,
    Status NVARCHAR(20) NULL
);</code></pre>

    <h3>4.5 TransformaÃ§Ã£o e carga das tabelas STG</h3>
    <pre><code class="language-sql">
        DECLARE @LoadDate DATETIME = GETDATE();
INSERT INTO dbo.stg_DimProduct (
    ProductAlternateKey,
    ProductSubcategoryKey,
    StandardCost,
    FinishedGoodsFlag,
    Color,
    ListPrice,
    SellStartDate,
    SellEndDate
)
SELECT
    p.ProductNumber,
    p.ProductSubcategoryID,
    p.StandardCost,
    p.FinishedGoodsFlag,
    p.Color,
    p.ListPrice,
    p.SellStartDate,
    p.SellEndDate,
    CASE 
        WHEN p.SellEndDate < @LoadDate THEN 'Discontinued'
        ELSE 'Current'
    END
FROM Production.Product p
LEFT JOIN Production.ProductModel pm 
       ON p.ProductModelID = pm.ProductModelID
LEFT JOIN (
    SELECT pp.ProductID, pph.LargePhoto
    FROM Production.ProductProductPhoto pp
    JOIN Production.ProductPhoto pph 
         ON pp.ProductPhotoID = pph.ProductPhotoID
) ph ON p.ProductID = ph.ProductID;</code></pre>

    <h3>4.6 Carga das DimensÃµes usando MERGE</h3>
    <pre><code class="language-sql">
        MERGE DimProduct AS tgt
USING stg.DimProduct AS src
    ON tgt.ProductAlternateKey = src.ProductAlternateKey
WHEN MATCHED THEN
    UPDATE SET
        tgt.ProductSubcategoryKey = src.ProductSubcategoryKey,
        tgt.EnglishProductName    = src.EnglishProductName,
        tgt.Color                 = src.Color,
        tgt.StandardCost          = src.StandardCost,
        tgt.Status                = src.Status
WHEN NOT MATCHED THEN
    INSERT (
        ProductAlternateKey,
        ProductSubcategoryKey,
        EnglishProductName,
        Color,
        StandardCost,
        StartDate,
        EndDate,
        Status
    )
    VALUES (
        src.ProductAlternateKey,
        src.ProductSubcategoryKey,
        src.EnglishProductName,
        src.Color,
        src.StandardCost,
        GETDATE(),
        '9999-12-31',
        'Current'
    );</code></pre>

    <h3>4.7 CriaÃ§Ã£o e carga da tabela de fato (FactProductInventory)</h3>
    <pre><code class="language-sql">
        INSERT INTO dbo.FactProductInventory
(
    ProductKey,
    DateKey,
    MovementDate
)
SELECT 
    dp.ProductKey,
    dd.DateKey,
    dd.FullDateAlternateKey AS MovementDate
FROM dbo.DimProduct dp
CROSS JOIN dbo.DimDate dd
WHERE dd.FullDateAlternateKey BETWEEN '2010-01-01' AND '2014-12-31'
ORDER BY dp.ProductKey, dd.DateKey;</code></pre>

    <h3>4.8 CriaÃ§Ã£o dos relacionamentos</h3>
    <pre><code class="language-sql">
        ALTER TABLE dbo.FactProductInventory
ADD CONSTRAINT FK_FactProductInventory_Product
    FOREIGN KEY (ProductKey) REFERENCES dbo.DimProduct(ProductKey);

ALTER TABLE dbo.FactProductInventory
ADD CONSTRAINT FK_FactProductInventory_Date
    FOREIGN KEY (DateKey) REFERENCES dbo.DimDate(DateKey);</code></pre>
</div>

<div class="section">
    <h2><span class="emoji">ðŸ“Œ</span>5. Regras de NegÃ³cio</h2>
    <ul>
        <li>Cada movimento pertence a um produto (ProductKey)</li>
        <li>Cada movimento pertence a um dia especÃ­fico (DateKey)</li>
        <li>Integridade garantida via FK (ProductKey, DateKey)</li>
    </ul>
</div>

<div class="section">
    <h2><span class="emoji">ðŸ“Œ</span>6. DecisÃµes de Modelagem</h2>
    <ul>
        <li>Colunas de traduÃ§Ã£o (Spanish, French, etc) como NULL nas dimensÃµes para reduzir volume e focar nos atributos necessÃ¡rios ao fluxo ETL.</li>
        <li>Colunas NULL na Fact: refletindo ausÃªncia de dados completos no OLTP e para simplificar a modelagem.</li>
    </ul>
</div>

<div class="section">
    <h2><span class="emoji">ðŸ“Œ</span>7. ValidaÃ§Ãµes Realizadas</h2>
    <ul>
        <li>ConferÃªncia de granularidade da Fact</li>
        <li>VerificaÃ§Ã£o de schema via <code>sp_help</code></li>
        <li>Testes de integridade referencial (FKs)</li>
        <li>ConferÃªncia de duplicidades</li>
        <li>ConfirmaÃ§Ã£o de SKs funcionando</li>
    </ul>
</div>

<div class="section">
    <h2><span class="emoji">ðŸ“Œ</span>8. Estrutura do RepositÃ³rio</h2>
    <pre>
sql/
â”‚
â”œâ”€â”€ create_tables/
â”‚   â”œâ”€â”€ create_tables.sql
â”‚   â””â”€â”€ create_tables_stg.sql
â”‚
â”œâ”€â”€ load/
â”‚   â”œâ”€â”€ load_stg_dim_product.sql
â”‚   â”œâ”€â”€ load_stg_dim_product_category.sql
â”‚   â”œâ”€â”€ load_stg_dim_product_sub_category.sql
â”‚   â”œâ”€â”€ load_dim_date.sql
â”‚   â””â”€â”€ load_fact_product_inventory.sql
â”‚
â”œâ”€â”€ merge/
â”‚   â”œâ”€â”€ merge_dim_product.sql
â”‚   â”œâ”€â”€ merge_dim_product_category.sql
â”‚   â””â”€â”€ merge_dim_product_sub_category.sql
â”‚
â””â”€â”€ constraints/
    â”œâ”€â”€ fk_dim_product_product_sub_category.sql
    â”œâ”€â”€ fk_dim_product_sub_category_category.sql
    â””â”€â”€ fk_fact_product_inventory.sql
    </pre>
</div>

<div class="section">
    <h2><span class="emoji">ðŸ“Œ</span>9. Aprendizados</h2>
    <ul>
        <li>Modelagem dimensional com SQL Server</li>
        <li>Identificar e mapear dados no OLTP para modelar o DW (OLAP)</li>
        <li>CriaÃ§Ã£o de dimensÃµes e fato com chaves surrogate (IDENTITY)</li>
        <li>ConstruÃ§Ã£o e padronizaÃ§Ã£o de DimDate</li>
        <li>Processo ETL completo: extraÃ§Ã£o, transformaÃ§Ã£o e carga</li>
        <li>CriaÃ§Ã£o de tabelas STG e uso como camada intermediÃ¡ria</li>
        <li>Uso do comando MERGE para atualizar/inserir no DW</li>
        <li>Boas prÃ¡ticas de documentaÃ§Ã£o para projetos de dados</li>
    </ul>
</div>

<div class="section">
    <h2><span class="emoji">ðŸ“Œ</span>10. PrÃ³ximos Passos</h2>
    <ul>
        <li>Expandir o DW para incluir novos mÃ³dulos do AdventureWorks</li>
        <li>Criar dashboards analÃ­ticos (Power BI / Tableau) consumindo este DW</li>
    </ul>
</div>

<div class="section">
    <h2><span class="emoji">ðŸ“Œ</span>11. ReferÃªncias</h2>
    <p><a href="https://dataedo.com/samples/html/Data_warehouse/" target="_blank">https://dataedo.com/samples/html/Data_warehouse/</a></p>
</div>

<div class="section">
    <h2><span class="emoji">ðŸ“Œ</span>12. Autor</h2>
    <p>Leonardo Bonani<br>
    Contato: <a href="https://www.linkedin.com/in/leonardo-bonani" target="_blank">www.linkedin.com/in/leonardo-bonani</a></p>
</div>

</body>
</html>
